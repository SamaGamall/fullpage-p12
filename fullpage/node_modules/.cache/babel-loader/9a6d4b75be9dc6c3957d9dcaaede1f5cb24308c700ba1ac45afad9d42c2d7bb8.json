{"ast":null,"code":"'use strict';\n\n/*!\n * Module dependencies.\n */\nconst EventEmitter = require('events').EventEmitter;\n\n/*!\n * ignore\n */\n\nclass ChangeStream extends EventEmitter {\n  constructor(changeStreamThunk, pipeline, options) {\n    super();\n    this.driverChangeStream = null;\n    this.closed = false;\n    this.bindedEvents = false;\n    this.pipeline = pipeline;\n    this.options = options;\n    if (options && options.hydrate && !options.model) {\n      throw new Error('Cannot create change stream with `hydrate: true` ' + 'unless calling `Model.watch()`');\n    }\n\n    // This wrapper is necessary because of buffering.\n    changeStreamThunk((err, driverChangeStream) => {\n      if (err != null) {\n        this.emit('error', err);\n        return;\n      }\n      this.driverChangeStream = driverChangeStream;\n      this.emit('ready');\n    });\n  }\n  _bindEvents() {\n    if (this.bindedEvents) {\n      return;\n    }\n    this.bindedEvents = true;\n    if (this.driverChangeStream == null) {\n      this.once('ready', () => {\n        this.driverChangeStream.on('close', () => {\n          this.closed = true;\n        });\n        ['close', 'change', 'end', 'error'].forEach(ev => {\n          this.driverChangeStream.on(ev, data => {\n            // Sometimes Node driver still polls after close, so\n            // avoid any uncaught exceptions due to closed change streams\n            // See tests for gh-7022\n            if (ev === 'error' && this.closed) {\n              return;\n            }\n            if (data != null && data.fullDocument != null && this.options && this.options.hydrate) {\n              data.fullDocument = this.options.model.hydrate(data.fullDocument);\n            }\n            this.emit(ev, data);\n          });\n        });\n      });\n      return;\n    }\n    this.driverChangeStream.on('close', () => {\n      this.closed = true;\n    });\n    ['close', 'change', 'end', 'error'].forEach(ev => {\n      this.driverChangeStream.on(ev, data => {\n        // Sometimes Node driver still polls after close, so\n        // avoid any uncaught exceptions due to closed change streams\n        // See tests for gh-7022\n        if (ev === 'error' && this.closed) {\n          return;\n        }\n        this.emit(ev, data);\n      });\n    });\n  }\n  hasNext(cb) {\n    return this.driverChangeStream.hasNext(cb);\n  }\n  next(cb) {\n    if (this.options && this.options.hydrate) {\n      if (cb != null) {\n        const originalCb = cb;\n        cb = (err, data) => {\n          if (err != null) {\n            return originalCb(err);\n          }\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return originalCb(null, data);\n        };\n      }\n      let maybePromise = this.driverChangeStream.next(cb);\n      if (maybePromise && typeof maybePromise.then === 'function') {\n        maybePromise = maybePromise.then(data => {\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return data;\n        });\n      }\n      return maybePromise;\n    }\n    return this.driverChangeStream.next(cb);\n  }\n  on(event, handler) {\n    this._bindEvents();\n    return super.on(event, handler);\n  }\n  once(event, handler) {\n    this._bindEvents();\n    return super.once(event, handler);\n  }\n  _queue(cb) {\n    this.once('ready', () => cb());\n  }\n  close() {\n    this.closed = true;\n    if (this.driverChangeStream) {\n      this.driverChangeStream.close();\n    }\n  }\n}\n\n/*!\n * ignore\n */\n\nmodule.exports = ChangeStream;","map":{"version":3,"names":["EventEmitter","require","ChangeStream","constructor","changeStreamThunk","pipeline","options","driverChangeStream","closed","bindedEvents","hydrate","model","Error","err","emit","_bindEvents","once","on","forEach","ev","data","fullDocument","hasNext","cb","next","originalCb","maybePromise","then","event","handler","_queue","close","module","exports"],"sources":["C:/Users/sama/Documents/fullpage/node_modules/mongoose/lib/cursor/ChangeStream.js"],"sourcesContent":["'use strict';\n\n/*!\n * Module dependencies.\n */\n\nconst EventEmitter = require('events').EventEmitter;\n\n/*!\n * ignore\n */\n\nclass ChangeStream extends EventEmitter {\n  constructor(changeStreamThunk, pipeline, options) {\n    super();\n\n    this.driverChangeStream = null;\n    this.closed = false;\n    this.bindedEvents = false;\n    this.pipeline = pipeline;\n    this.options = options;\n\n    if (options && options.hydrate && !options.model) {\n      throw new Error(\n        'Cannot create change stream with `hydrate: true` ' +\n        'unless calling `Model.watch()`'\n      );\n    }\n\n    // This wrapper is necessary because of buffering.\n    changeStreamThunk((err, driverChangeStream) => {\n      if (err != null) {\n        this.emit('error', err);\n        return;\n      }\n\n      this.driverChangeStream = driverChangeStream;\n      this.emit('ready');\n    });\n  }\n\n  _bindEvents() {\n    if (this.bindedEvents) {\n      return;\n    }\n\n    this.bindedEvents = true;\n\n    if (this.driverChangeStream == null) {\n      this.once('ready', () => {\n        this.driverChangeStream.on('close', () => {\n          this.closed = true;\n        });\n\n        ['close', 'change', 'end', 'error'].forEach(ev => {\n          this.driverChangeStream.on(ev, data => {\n            // Sometimes Node driver still polls after close, so\n            // avoid any uncaught exceptions due to closed change streams\n            // See tests for gh-7022\n            if (ev === 'error' && this.closed) {\n              return;\n            }\n            if (data != null && data.fullDocument != null && this.options && this.options.hydrate) {\n              data.fullDocument = this.options.model.hydrate(data.fullDocument);\n            }\n            this.emit(ev, data);\n          });\n        });\n      });\n\n      return;\n    }\n\n    this.driverChangeStream.on('close', () => {\n      this.closed = true;\n    });\n\n    ['close', 'change', 'end', 'error'].forEach(ev => {\n      this.driverChangeStream.on(ev, data => {\n        // Sometimes Node driver still polls after close, so\n        // avoid any uncaught exceptions due to closed change streams\n        // See tests for gh-7022\n        if (ev === 'error' && this.closed) {\n          return;\n        }\n        this.emit(ev, data);\n      });\n    });\n  }\n\n  hasNext(cb) {\n    return this.driverChangeStream.hasNext(cb);\n  }\n\n  next(cb) {\n    if (this.options && this.options.hydrate) {\n      if (cb != null) {\n        const originalCb = cb;\n        cb = (err, data) => {\n          if (err != null) {\n            return originalCb(err);\n          }\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return originalCb(null, data);\n        };\n      }\n\n      let maybePromise = this.driverChangeStream.next(cb);\n      if (maybePromise && typeof maybePromise.then === 'function') {\n        maybePromise = maybePromise.then(data => {\n          if (data.fullDocument != null) {\n            data.fullDocument = this.options.model.hydrate(data.fullDocument);\n          }\n          return data;\n        });\n      }\n      return maybePromise;\n    }\n\n    return this.driverChangeStream.next(cb);\n  }\n\n  on(event, handler) {\n    this._bindEvents();\n    return super.on(event, handler);\n  }\n\n  once(event, handler) {\n    this._bindEvents();\n    return super.once(event, handler);\n  }\n\n  _queue(cb) {\n    this.once('ready', () => cb());\n  }\n\n  close() {\n    this.closed = true;\n    if (this.driverChangeStream) {\n      this.driverChangeStream.close();\n    }\n  }\n}\n\n/*!\n * ignore\n */\n\nmodule.exports = ChangeStream;\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}