{"ast":null,"code":"'use strict';\n\nconst clone = require('./clone');\nconst MongooseError = require('../error/index');\nfunction processConnectionOptions(uri, options) {\n  const opts = options ? options : {};\n  const readPreference = opts.readPreference ? opts.readPreference : getUriReadPreference(uri);\n  const resolvedOpts = readPreference && readPreference !== 'primary' && readPreference !== 'primaryPreferred' ? resolveOptsConflicts(readPreference, opts) : opts;\n  return clone(resolvedOpts);\n}\nfunction resolveOptsConflicts(pref, opts) {\n  // don't silently override user-provided indexing options\n  if (setsIndexOptions(opts) && setsSecondaryRead(pref)) {\n    throwReadPreferenceError();\n  }\n\n  // if user has not explicitly set any auto-indexing options,\n  // we can silently default them all to false\n  else {\n    return defaultIndexOptsToFalse(opts);\n  }\n}\nfunction setsIndexOptions(opts) {\n  const configIdx = opts.config && opts.config.autoIndex;\n  const {\n    autoCreate,\n    autoIndex\n  } = opts;\n  return !!(configIdx || autoCreate || autoIndex);\n}\nfunction setsSecondaryRead(prefString) {\n  return !!(prefString === 'secondary' || prefString === 'secondaryPreferred');\n}\nfunction getUriReadPreference(connectionString) {\n  const exp = /(?:&|\\?)readPreference=(\\w+)(?:&|$)/;\n  const match = exp.exec(connectionString);\n  return match ? match[1] : null;\n}\nfunction defaultIndexOptsToFalse(opts) {\n  opts.config = {\n    autoIndex: false\n  };\n  opts.autoCreate = false;\n  opts.autoIndex = false;\n  return opts;\n}\nfunction throwReadPreferenceError() {\n  throw new MongooseError('MongoDB prohibits index creation on connections that read from ' + 'non-primary replicas.  Connections that set \"readPreference\" to \"secondary\" or ' + '\"secondaryPreferred\" may not opt-in to the following connection options: ' + 'autoCreate, autoIndex');\n}\nmodule.exports = processConnectionOptions;","map":{"version":3,"names":["clone","require","MongooseError","processConnectionOptions","uri","options","opts","readPreference","getUriReadPreference","resolvedOpts","resolveOptsConflicts","pref","setsIndexOptions","setsSecondaryRead","throwReadPreferenceError","defaultIndexOptsToFalse","configIdx","config","autoIndex","autoCreate","prefString","connectionString","exp","match","exec","module","exports"],"sources":["C:/Users/sama/Documents/fullpage/node_modules/mongoose/lib/helpers/processConnectionOptions.js"],"sourcesContent":["'use strict';\n\nconst clone = require('./clone');\nconst MongooseError = require('../error/index');\n\nfunction processConnectionOptions(uri, options) {\n  const opts = options ? options : {};\n  const readPreference = opts.readPreference\n    ? opts.readPreference\n    : getUriReadPreference(uri);\n\n  const resolvedOpts = (readPreference && readPreference !== 'primary' && readPreference !== 'primaryPreferred')\n    ? resolveOptsConflicts(readPreference, opts)\n    : opts;\n\n  return clone(resolvedOpts);\n}\n\nfunction resolveOptsConflicts(pref, opts) {\n  // don't silently override user-provided indexing options\n  if (setsIndexOptions(opts) && setsSecondaryRead(pref)) {\n    throwReadPreferenceError();\n  }\n\n  // if user has not explicitly set any auto-indexing options,\n  // we can silently default them all to false\n  else {\n    return defaultIndexOptsToFalse(opts);\n  }\n}\n\nfunction setsIndexOptions(opts) {\n  const configIdx = opts.config && opts.config.autoIndex;\n  const { autoCreate, autoIndex } = opts;\n  return !!(configIdx || autoCreate || autoIndex);\n}\n\nfunction setsSecondaryRead(prefString) {\n  return !!(prefString === 'secondary' || prefString === 'secondaryPreferred');\n}\n\nfunction getUriReadPreference(connectionString) {\n  const exp = /(?:&|\\?)readPreference=(\\w+)(?:&|$)/;\n  const match = exp.exec(connectionString);\n  return match ? match[1] : null;\n}\n\nfunction defaultIndexOptsToFalse(opts) {\n  opts.config = { autoIndex: false };\n  opts.autoCreate = false;\n  opts.autoIndex = false;\n  return opts;\n}\n\nfunction throwReadPreferenceError() {\n  throw new MongooseError(\n    'MongoDB prohibits index creation on connections that read from ' +\n            'non-primary replicas.  Connections that set \"readPreference\" to \"secondary\" or ' +\n            '\"secondaryPreferred\" may not opt-in to the following connection options: ' +\n            'autoCreate, autoIndex'\n  );\n}\n\nmodule.exports = processConnectionOptions;\n"],"mappings":"AAAA,YAAY;;AAEZ,MAAMA,KAAK,GAAGC,OAAO,CAAC,SAAS,CAAC;AAChC,MAAMC,aAAa,GAAGD,OAAO,CAAC,gBAAgB,CAAC;AAE/C,SAASE,wBAAwBA,CAACC,GAAG,EAAEC,OAAO,EAAE;EAC9C,MAAMC,IAAI,GAAGD,OAAO,GAAGA,OAAO,GAAG,CAAC,CAAC;EACnC,MAAME,cAAc,GAAGD,IAAI,CAACC,cAAc,GACtCD,IAAI,CAACC,cAAc,GACnBC,oBAAoB,CAACJ,GAAG,CAAC;EAE7B,MAAMK,YAAY,GAAIF,cAAc,IAAIA,cAAc,KAAK,SAAS,IAAIA,cAAc,KAAK,kBAAkB,GACzGG,oBAAoB,CAACH,cAAc,EAAED,IAAI,CAAC,GAC1CA,IAAI;EAER,OAAON,KAAK,CAACS,YAAY,CAAC;AAC5B;AAEA,SAASC,oBAAoBA,CAACC,IAAI,EAAEL,IAAI,EAAE;EACxC;EACA,IAAIM,gBAAgB,CAACN,IAAI,CAAC,IAAIO,iBAAiB,CAACF,IAAI,CAAC,EAAE;IACrDG,wBAAwB,EAAE;EAC5B;;EAEA;EACA;EAAA,KACK;IACH,OAAOC,uBAAuB,CAACT,IAAI,CAAC;EACtC;AACF;AAEA,SAASM,gBAAgBA,CAACN,IAAI,EAAE;EAC9B,MAAMU,SAAS,GAAGV,IAAI,CAACW,MAAM,IAAIX,IAAI,CAACW,MAAM,CAACC,SAAS;EACtD,MAAM;IAAEC,UAAU;IAAED;EAAU,CAAC,GAAGZ,IAAI;EACtC,OAAO,CAAC,EAAEU,SAAS,IAAIG,UAAU,IAAID,SAAS,CAAC;AACjD;AAEA,SAASL,iBAAiBA,CAACO,UAAU,EAAE;EACrC,OAAO,CAAC,EAAEA,UAAU,KAAK,WAAW,IAAIA,UAAU,KAAK,oBAAoB,CAAC;AAC9E;AAEA,SAASZ,oBAAoBA,CAACa,gBAAgB,EAAE;EAC9C,MAAMC,GAAG,GAAG,qCAAqC;EACjD,MAAMC,KAAK,GAAGD,GAAG,CAACE,IAAI,CAACH,gBAAgB,CAAC;EACxC,OAAOE,KAAK,GAAGA,KAAK,CAAC,CAAC,CAAC,GAAG,IAAI;AAChC;AAEA,SAASR,uBAAuBA,CAACT,IAAI,EAAE;EACrCA,IAAI,CAACW,MAAM,GAAG;IAAEC,SAAS,EAAE;EAAM,CAAC;EAClCZ,IAAI,CAACa,UAAU,GAAG,KAAK;EACvBb,IAAI,CAACY,SAAS,GAAG,KAAK;EACtB,OAAOZ,IAAI;AACb;AAEA,SAASQ,wBAAwBA,CAAA,EAAG;EAClC,MAAM,IAAIZ,aAAa,CACrB,iEAAiE,GACzD,iFAAiF,GACjF,2EAA2E,GAC3E,uBAAuB,CAChC;AACH;AAEAuB,MAAM,CAACC,OAAO,GAAGvB,wBAAwB"},"metadata":{},"sourceType":"script","externalDependencies":[]}